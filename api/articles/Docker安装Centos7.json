{"title":"Docker 安装 Centos7","slug":"Docker安装Centos7","date":"2021-12-12T08:25:44.000Z","updated":"2022-01-04T16:50:38.000Z","comments":true,"path":"api/articles/Docker安装Centos7.json","excerpt":null,"covers":["https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220223145834.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220223145949.png"],"content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>本地化启动一个 <code>Linux</code> 服务器，使用 <code>Docker</code> 容器来构建一个包含 SSH 服务的 Linux 镜像。</p>\n<h2 id=\"准备-centos-官方镜像\"><a href=\"#准备-centos-官方镜像\" class=\"headerlink\" title=\"准备 centos 官方镜像\"></a>准备 centos 官方镜像</h2><p>具体步骤：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">1、拉取centos7官方镜像</span></span><br><span class=\"line\">docker pull centos:7</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">2、启动镜像</span></span><br><span class=\"line\">docker run -itd --privileged centos:7 init</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">3、进入容器bash中</span></span><br><span class=\"line\">docker exec -it 镜像ID bash</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">4、修改root用户密码</span></span><br><span class=\"line\">[root@33c7ee24f43e /]# passwd</span><br><span class=\"line\">Changing password for user root.</span><br><span class=\"line\">New password:</span><br><span class=\"line\">BAD PASSWORD: The password is shorter than 8 characters</span><br><span class=\"line\">Retype new password:</span><br><span class=\"line\">passwd: all authentication tokens updated successfully.</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">5、安装和配置ssh服务</span></span><br><span class=\"line\">yum install openssh-server -y</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">6、修改/etc/ssh/sshd_config配置并保存：PermitRootLogin <span class=\"built_in\">yes</span>    UsePAM no</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220223145834.png\" alt=\"image-20220223145827608\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220223145949.png\" alt=\"image-20220223145949729\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">7、启动ssh服务</span></span><br><span class=\"line\">[root@33c7ee24f43e /]# systemctl start sshd</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">8、退出容器</span></span><br><span class=\"line\">[root@33c7ee24f43e /]# exit</span><br><span class=\"line\">exit</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"构建镜像\"><a href=\"#构建镜像\" class=\"headerlink\" title=\"构建镜像\"></a>构建镜像</h2><p>通过 <code>docker commit</code> 来构建包含 ssh 服务的镜像</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">1、通过commit构建镜像</span></span><br><span class=\"line\">docker commit -a=&quot;Irving&quot; -m=&quot;本地linux镜像&quot; 容器ID mycentos:1.0</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">2、启动镜像 -p 10000:22 映射本地10000端口</span></span><br><span class=\"line\">docker run -d -p 10000:22 --name 容器名 镜像ID /usr/sbin/sshd -D</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用-xshell-进行连接\"><a href=\"#使用-xshell-进行连接\" class=\"headerlink\" title=\"使用 xshell 进行连接\"></a>使用 xshell 进行连接</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh://root:****@127.0.0.1:10000</span><br></pre></td></tr></table></figure>\n","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>本地化启动一个 <code>Linux</code> 服务器，使用 <code>Docker</code> 容器来构建一个包含 SSH 服务的 Linux 镜像。</p>\n<h2 id=\"准备-centos-官方镜像\"><a href=\"#准备-centos-官方镜像\" class=\"headerlink\" title=\"准备 centos 官方镜像\"></a>准备 centos 官方镜像</h2><p>具体步骤：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">1、拉取centos7官方镜像</span></span><br><span class=\"line\">docker pull centos:7</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">2、启动镜像</span></span><br><span class=\"line\">docker run -itd --privileged centos:7 init</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">3、进入容器bash中</span></span><br><span class=\"line\">docker exec -it 镜像ID bash</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">4、修改root用户密码</span></span><br><span class=\"line\">[root@33c7ee24f43e /]# passwd</span><br><span class=\"line\">Changing password for user root.</span><br><span class=\"line\">New password:</span><br><span class=\"line\">BAD PASSWORD: The password is shorter than 8 characters</span><br><span class=\"line\">Retype new password:</span><br><span class=\"line\">passwd: all authentication tokens updated successfully.</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">5、安装和配置ssh服务</span></span><br><span class=\"line\">yum install openssh-server -y</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">6、修改/etc/ssh/sshd_config配置并保存：PermitRootLogin <span class=\"built_in\">yes</span>    UsePAM no</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220223145834.png\" alt=\"image-20220223145827608\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220223145949.png\" alt=\"image-20220223145949729\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">7、启动ssh服务</span></span><br><span class=\"line\">[root@33c7ee24f43e /]# systemctl start sshd</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">8、退出容器</span></span><br><span class=\"line\">[root@33c7ee24f43e /]# exit</span><br><span class=\"line\">exit</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"构建镜像\"><a href=\"#构建镜像\" class=\"headerlink\" title=\"构建镜像\"></a>构建镜像</h2><p>通过 <code>docker commit</code> 来构建包含 ssh 服务的镜像</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">1、通过commit构建镜像</span></span><br><span class=\"line\">docker commit -a=&quot;Irving&quot; -m=&quot;本地linux镜像&quot; 容器ID mycentos:1.0</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">2、启动镜像 -p 10000:22 映射本地10000端口</span></span><br><span class=\"line\">docker run -d -p 10000:22 --name 容器名 镜像ID /usr/sbin/sshd -D</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用-xshell-进行连接\"><a href=\"#使用-xshell-进行连接\" class=\"headerlink\" title=\"使用 xshell 进行连接\"></a>使用 xshell 进行连接</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh://root:****@127.0.0.1:10000</span><br></pre></td></tr></table></figure>\n","categories":[{"name":"Linux","path":"api/categories/Linux.json"}],"tags":[{"name":"Docker","path":"api/tags/Docker.json"},{"name":"容器","path":"api/tags/容器.json"}]}