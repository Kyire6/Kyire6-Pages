{"title":"玩转网络文件系统（NFS）服务","slug":"玩转网络文件系统（NFS）服务","date":"2023-08-17T09:22:24.000Z","updated":"2023-08-17T09:22:24.000Z","comments":true,"path":"api/articles/玩转网络文件系统（NFS）服务.json","excerpt":null,"covers":["https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402971.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402932.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402145.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402008.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402407.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402833.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402739.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402816.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402641.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402336.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402579.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181407601.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181408416.png"],"content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>公司有一个前后端不分离的单体项目，遇到一个场景，甲方要求应用服务分别部署到两台不同的服务器（<code>Windows Server 2022</code>）上，通过网关负载均衡进行访问（<code>集群部署</code>）。</p>\n<p>其中项目中有块业务涉及到文件上传、在线预览等功能。项目是部署在内网服务器，并且甲方也没有提供专门的文件服务器，所以项目中的文件上传都是上传到应用服务所在服务器上，因为是集群部署负载均衡进行访问，避免两台应用服务器之间的文件不同步，导致用户预览时异常，最终选择了 <code>NFS 网络文件系统</code> 实现共享文件夹。</p>\n<h2 id=\"NFS-共享文件夹实现步骤\"><a href=\"#NFS-共享文件夹实现步骤\" class=\"headerlink\" title=\"NFS 共享文件夹实现步骤\"></a>NFS 共享文件夹实现步骤</h2><h3 id=\"Windows-服务器\"><a href=\"#Windows-服务器\" class=\"headerlink\" title=\"Windows 服务器\"></a>Windows 服务器</h3><h4 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h4><ol>\n<li>需要配置源服务器（被共享文件夹所在的服务器）的防火墙端口 <code>111</code> 和 <code>2049</code></li>\n<li>可以先关闭两台机器的防火墙，配置完成之后再打开，如果有问题再检查防火墙出入站规则</li>\n</ol>\n<h4 id=\"安装-NFS-服务器功能（已安装可略过）\"><a href=\"#安装-NFS-服务器功能（已安装可略过）\" class=\"headerlink\" title=\"安装 NFS 服务器功能（已安装可略过）\"></a>安装 NFS 服务器功能（已安装可略过）</h4><ol>\n<li>打开服务器管理器，添加角色和功能</li>\n</ol>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402971.png\" alt=\"image-20230818171512533\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402932.png\" alt=\"image-20230818171638594\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402145.png\" alt=\"image-20230818171728872\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402008.png\" alt=\"image-20230818171801367\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402407.png\" alt=\"image-20230818171914089\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402833.png\" alt=\"image-20230818172010661\"></p>\n<ol start=\"2\">\n<li>安装所选功能，默认 <code>下一步 -&gt; 安装</code> 即可</li>\n</ol>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402739.png\" alt=\"image-20230818172537913\"></p>\n<h4 id=\"在源服务器上设置共享文件夹\"><a href=\"#在源服务器上设置共享文件夹\" class=\"headerlink\" title=\"在源服务器上设置共享文件夹\"></a>在源服务器上设置共享文件夹</h4><ol>\n<li>选中需要共享的文件夹，右键属性，设置 NFS 共享</li>\n</ol>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402816.png\" alt=\"image-20230818173043659\">    </p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402641.png\" alt=\"image-20230818173126286\">    </p>\n<ol start=\"2\">\n<li>设置读写权限</li>\n</ol>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402336.png\" alt=\"image-20230818173159245\">    </p>\n<h4 id=\"在目标服务器上添加网络驱动器\"><a href=\"#在目标服务器上添加网络驱动器\" class=\"headerlink\" title=\"在目标服务器上添加网络驱动器\"></a>在目标服务器上添加网络驱动器</h4><p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402579.png\" alt=\"image-20230818173737941\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181407601.png\" alt=\"image-20230918140756876\">    </p>\n<p>映射完成之后会在此电脑中的网络位置中显示</p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181408416.png\" alt=\"image-20230918140849304\"></p>\n<h4 id=\"可以通过命令创建目录链接，将网络位置添加的-Z-盘映射成一个文件目录，供其他位置使用\"><a href=\"#可以通过命令创建目录链接，将网络位置添加的-Z-盘映射成一个文件目录，供其他位置使用\" class=\"headerlink\" title=\"可以通过命令创建目录链接，将网络位置添加的 Z 盘映射成一个文件目录，供其他位置使用\"></a>可以通过命令创建目录链接，将网络位置添加的 Z 盘映射成一个文件目录，供其他位置使用</h4><p>命令如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mklink /H D:\\opt Z:\\</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Linux-服务器\"><a href=\"#Linux-服务器\" class=\"headerlink\" title=\"Linux 服务器\"></a>Linux 服务器</h3><p>步骤如下：</p>\n<p>192.168.116.17 作为服务端，共享数据给 192.168.116.18</p>\n<h4 id=\"服务端配置\"><a href=\"#服务端配置\" class=\"headerlink\" title=\"服务端配置\"></a>服务端配置</h4><ol>\n<li><p>安装 nfs server</p>\n</li>\n<li><p>设置 nfs 共享目录</p>\n</li>\n<li><p>重启 nfs server</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装 nfs server（Ubuntu 系统）</span></span><br><span class=\"line\">sudo apt-get install nfs-kernel-server nfs-common</span><br><span class=\"line\"><span class=\"comment\"># 安装 nfs server（Centos 系统）</span></span><br><span class=\"line\">sudo yum install nfs-utils</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置 nfs 共享目录</span></span><br><span class=\"line\">sudo vim /etc/exports</span><br><span class=\"line\">/u01/opt            *(rw,no_root_squash,<span class=\"built_in\">sync</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启 nfs server（Ubuntu 系统）</span></span><br><span class=\"line\">sudo service nfs-kernel-server restart</span><br><span class=\"line\"><span class=\"comment\"># 重启 nfs server（Centos 系统）</span></span><br><span class=\"line\">sudo systemctl restart nfs-server </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"客户端配置\"><a href=\"#客户端配置\" class=\"headerlink\" title=\"客户端配置\"></a>客户端配置</h4><ol>\n<li>安装 nfs client</li>\n<li>查看服务端上共享的目录</li>\n<li>创建共享挂载点，并执行挂载</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装 nfs client（Ubuntu 系统）</span></span><br><span class=\"line\">sudo apt-get install nfs-common</span><br><span class=\"line\"><span class=\"comment\"># 安装 nfs client（Centos 系统）</span></span><br><span class=\"line\">sudo yum install nfs-common</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看服务端上共享的目录</span></span><br><span class=\"line\">showmount -e 192.168.116.17</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建共享挂载点，并执行挂载</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /u01/opt</span><br><span class=\"line\">mount -t nfs 192.168.116.17:/u01/opt /u01/opt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置开机自动挂载</span></span><br><span class=\"line\"><span class=\"comment\"># Ubuntu 系统</span></span><br><span class=\"line\">192.168.116.17:/u01/opt /u01/opt nfs defaults 0 0</span><br><span class=\"line\"><span class=\"comment\"># CentOS 系统</span></span><br><span class=\"line\">192.168.88.230:/u01/opt /u01/opt nfs rw,auto,nofail,noatime,nolock,intr,tcp,actimeo=1800,noac 0 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 取消挂载</span></span><br><span class=\"line\">umount -lf /u01/opt</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本文简单记录了 Windows 服务器、Linux 服务器上使用 NFS 共享文件夹的步骤。</p>\n","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>公司有一个前后端不分离的单体项目，遇到一个场景，甲方要求应用服务分别部署到两台不同的服务器（<code>Windows Server 2022</code>）上，通过网关负载均衡进行访问（<code>集群部署</code>）。</p>\n<p>其中项目中有块业务涉及到文件上传、在线预览等功能。项目是部署在内网服务器，并且甲方也没有提供专门的文件服务器，所以项目中的文件上传都是上传到应用服务所在服务器上，因为是集群部署负载均衡进行访问，避免两台应用服务器之间的文件不同步，导致用户预览时异常，最终选择了 <code>NFS 网络文件系统</code> 实现共享文件夹。</p>\n<h2 id=\"NFS-共享文件夹实现步骤\"><a href=\"#NFS-共享文件夹实现步骤\" class=\"headerlink\" title=\"NFS 共享文件夹实现步骤\"></a>NFS 共享文件夹实现步骤</h2><h3 id=\"Windows-服务器\"><a href=\"#Windows-服务器\" class=\"headerlink\" title=\"Windows 服务器\"></a>Windows 服务器</h3><h4 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h4><ol>\n<li>需要配置源服务器（被共享文件夹所在的服务器）的防火墙端口 <code>111</code> 和 <code>2049</code></li>\n<li>可以先关闭两台机器的防火墙，配置完成之后再打开，如果有问题再检查防火墙出入站规则</li>\n</ol>\n<h4 id=\"安装-NFS-服务器功能（已安装可略过）\"><a href=\"#安装-NFS-服务器功能（已安装可略过）\" class=\"headerlink\" title=\"安装 NFS 服务器功能（已安装可略过）\"></a>安装 NFS 服务器功能（已安装可略过）</h4><ol>\n<li>打开服务器管理器，添加角色和功能</li>\n</ol>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402971.png\" alt=\"image-20230818171512533\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402932.png\" alt=\"image-20230818171638594\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402145.png\" alt=\"image-20230818171728872\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402008.png\" alt=\"image-20230818171801367\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402407.png\" alt=\"image-20230818171914089\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402833.png\" alt=\"image-20230818172010661\"></p>\n<ol start=\"2\">\n<li>安装所选功能，默认 <code>下一步 -&gt; 安装</code> 即可</li>\n</ol>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402739.png\" alt=\"image-20230818172537913\"></p>\n<h4 id=\"在源服务器上设置共享文件夹\"><a href=\"#在源服务器上设置共享文件夹\" class=\"headerlink\" title=\"在源服务器上设置共享文件夹\"></a>在源服务器上设置共享文件夹</h4><ol>\n<li>选中需要共享的文件夹，右键属性，设置 NFS 共享</li>\n</ol>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402816.png\" alt=\"image-20230818173043659\">    </p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402641.png\" alt=\"image-20230818173126286\">    </p>\n<ol start=\"2\">\n<li>设置读写权限</li>\n</ol>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402336.png\" alt=\"image-20230818173159245\">    </p>\n<h4 id=\"在目标服务器上添加网络驱动器\"><a href=\"#在目标服务器上添加网络驱动器\" class=\"headerlink\" title=\"在目标服务器上添加网络驱动器\"></a>在目标服务器上添加网络驱动器</h4><p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181402579.png\" alt=\"image-20230818173737941\"></p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181407601.png\" alt=\"image-20230918140756876\">    </p>\n<p>映射完成之后会在此电脑中的网络位置中显示</p>\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/202309181408416.png\" alt=\"image-20230918140849304\"></p>\n<h4 id=\"可以通过命令创建目录链接，将网络位置添加的-Z-盘映射成一个文件目录，供其他位置使用\"><a href=\"#可以通过命令创建目录链接，将网络位置添加的-Z-盘映射成一个文件目录，供其他位置使用\" class=\"headerlink\" title=\"可以通过命令创建目录链接，将网络位置添加的 Z 盘映射成一个文件目录，供其他位置使用\"></a>可以通过命令创建目录链接，将网络位置添加的 Z 盘映射成一个文件目录，供其他位置使用</h4><p>命令如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mklink /H D:\\opt Z:\\</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Linux-服务器\"><a href=\"#Linux-服务器\" class=\"headerlink\" title=\"Linux 服务器\"></a>Linux 服务器</h3><p>步骤如下：</p>\n<p>192.168.116.17 作为服务端，共享数据给 192.168.116.18</p>\n<h4 id=\"服务端配置\"><a href=\"#服务端配置\" class=\"headerlink\" title=\"服务端配置\"></a>服务端配置</h4><ol>\n<li><p>安装 nfs server</p>\n</li>\n<li><p>设置 nfs 共享目录</p>\n</li>\n<li><p>重启 nfs server</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装 nfs server（Ubuntu 系统）</span></span><br><span class=\"line\">sudo apt-get install nfs-kernel-server nfs-common</span><br><span class=\"line\"><span class=\"comment\"># 安装 nfs server（Centos 系统）</span></span><br><span class=\"line\">sudo yum install nfs-utils</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置 nfs 共享目录</span></span><br><span class=\"line\">sudo vim /etc/exports</span><br><span class=\"line\">/u01/opt            *(rw,no_root_squash,<span class=\"built_in\">sync</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启 nfs server（Ubuntu 系统）</span></span><br><span class=\"line\">sudo service nfs-kernel-server restart</span><br><span class=\"line\"><span class=\"comment\"># 重启 nfs server（Centos 系统）</span></span><br><span class=\"line\">sudo systemctl restart nfs-server </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"客户端配置\"><a href=\"#客户端配置\" class=\"headerlink\" title=\"客户端配置\"></a>客户端配置</h4><ol>\n<li>安装 nfs client</li>\n<li>查看服务端上共享的目录</li>\n<li>创建共享挂载点，并执行挂载</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装 nfs client（Ubuntu 系统）</span></span><br><span class=\"line\">sudo apt-get install nfs-common</span><br><span class=\"line\"><span class=\"comment\"># 安装 nfs client（Centos 系统）</span></span><br><span class=\"line\">sudo yum install nfs-common</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看服务端上共享的目录</span></span><br><span class=\"line\">showmount -e 192.168.116.17</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建共享挂载点，并执行挂载</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /u01/opt</span><br><span class=\"line\">mount -t nfs 192.168.116.17:/u01/opt /u01/opt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置开机自动挂载</span></span><br><span class=\"line\"><span class=\"comment\"># Ubuntu 系统</span></span><br><span class=\"line\">192.168.116.17:/u01/opt /u01/opt nfs defaults 0 0</span><br><span class=\"line\"><span class=\"comment\"># CentOS 系统</span></span><br><span class=\"line\">192.168.88.230:/u01/opt /u01/opt nfs rw,auto,nofail,noatime,nolock,intr,tcp,actimeo=1800,noac 0 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 取消挂载</span></span><br><span class=\"line\">umount -lf /u01/opt</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本文简单记录了 Windows 服务器、Linux 服务器上使用 NFS 共享文件夹的步骤。</p>\n","categories":[{"name":"随笔小记","path":"api/categories/随笔小记.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"Windows","path":"api/tags/Windows.json"},{"name":"NFS","path":"api/tags/NFS.json"}]}