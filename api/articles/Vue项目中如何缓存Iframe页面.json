{"title":"Vue 项目中如何缓存 Iframe 页面","slug":"Vue项目中如何缓存Iframe页面","date":"2023-07-03T00:45:36.000Z","updated":"2023-07-03T00:45:36.000Z","comments":true,"path":"api/articles/Vue项目中如何缓存Iframe页面.json","excerpt":null,"covers":null,"content":"<h2 id=\"项目背景\"><a href=\"#项目背景\" class=\"headerlink\" title=\"项目背景\"></a>项目背景</h2><p>在我们日常项目开发中，可能会涉及到其他项目嵌入到本项目中。本人在工作中正好碰到了一个需求，需要将旧系统中大量的 <code>HTML</code> 页面嵌入到 <code>Vue</code> 的项目中，嵌入方式是采用 <code>Iframe</code>，但是若使用 Iframe 嵌入页面，那么页面缓存就相当重要，否则用户每次切换到 Iframe 页面类型的菜单，都要重新加载页面，这样非常浪费时间，并且很影响用户的体验。经过网上查阅资料以及结合项目情况，这里记录一下本次问题的解决思路及实现方案。</p>\n<blockquote>\n<p>项目框架：<a href=\"https://github.com/jeecgboot/ant-design-vue-jeecg\">jeecgboot/ant-design-vue-jeecg: 基于 Vue2 + AntDesignVue 实现的 Ant Design Pro（github.com）</a></p>\n<p>参考：<a href=\"https://juejin.cn/post/7160873633408090119\">vue 应用缓存 iframe 页面 - 掘金 (juejin.cn)</a></p>\n</blockquote>\n<h2 id=\"解决思路\"><a href=\"#解决思路\" class=\"headerlink\" title=\"解决思路\"></a>解决思路</h2><ol>\n<li>通过自定义规则区分 Iframe 类型路由与非 Iframe 类型路由</li>\n<li>手动获取 Iframe 类型路由的路由信息，并且手动注册所有的 Iframe 路由组件</li>\n<li>Iframe 页面打开时或页面切换时，设置对应的 Iframe 组件为打开状态</li>\n<li>获取所有已打开的 Iframe 路由组件，<code>v-for</code> 循环展示 Iframe 路由组件，并根据当前路由信息结合组件信息判断，使用 <code>v-show</code> 控制组件的显隐</li>\n</ol>\n<blockquote>\n<p><strong>关键：将所有 Iframe 类型页面全部注册为 Vue 组件，并且通过打开状态进行展示（懒加载），通过路由信息来控制组件的显隐状态（缓存）</strong></p>\n</blockquote>\n<h2 id=\"实现方案\"><a href=\"#实现方案\" class=\"headerlink\" title=\"实现方案\"></a>实现方案</h2><h3 id=\"区分-Iframe-路由\"><a href=\"#区分-Iframe-路由\" class=\"headerlink\" title=\"区分 Iframe 路由\"></a>区分 Iframe 路由</h3><p>本项目中是使用路由信息中 <code>meta</code> 数据中的 <code>componentName</code> 来判断的，只要 componentName 包含 Iframe 就代表是 <code>Iframe</code> 类型的路由（区分规则以实际项目为准）</p>\n<h3 id=\"获取所有的-Iframe-路由组件\"><a href=\"#获取所有的-Iframe-路由组件\" class=\"headerlink\" title=\"获取所有的 Iframe 路由组件\"></a>获取所有的 Iframe 路由组件</h3><p>本项目中采用了动态路由，数据存放在 <code>Vuex</code> 中，用户登录时从数据库加载当前用户的路由菜单。并且项目脚手架是使用 <code>Ant Design Pro</code>，采用的是 Tab 多页签模式，所以在关闭 Tab 时也需要修改 Iframe 组件的状态，所以将 Iframe 组件列表也存放在 Vuex 中，方便在不同组件中共享数据</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">computed</span>: &#123;</span><br><span class=\"line\">  ...<span class=\"title function_\">mapState</span>(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 动态路由</span></span><br><span class=\"line\">    <span class=\"attr\">mainMenu</span>: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> state.<span class=\"property\">user</span>.<span class=\"property\">allPermissionList</span>,</span><br><span class=\"line\">    <span class=\"attr\">iframeComponentList</span>: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> state.<span class=\"property\">app</span>.<span class=\"property\">iframeComponentList</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"attr\">methods</span>: &#123;</span><br><span class=\"line\">  <span class=\"title function_\">getIframeComponentList</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> iframeMenuList = <span class=\"variable language_\">this</span>.<span class=\"title function_\">handleIframe</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">mainMenu</span>, [])</span><br><span class=\"line\">    <span class=\"keyword\">const</span> iframeComponentList = iframeMenuList.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">item, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 设置组件</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> component = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(item.<span class=\"property\">component</span>.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&quot;layouts&quot;</span>)&gt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        component = <span class=\"string\">&quot;components/&quot;</span>+item.<span class=\"property\">component</span>;</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        component = <span class=\"string\">&quot;views/&quot;</span>+item.<span class=\"property\">component</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> <span class=\"title function_\">componentPath</span> = resolve =&gt; <span class=\"built_in\">require</span>([<span class=\"string\">&#x27;@/&#x27;</span> + component+<span class=\"string\">&#x27;.vue&#x27;</span>], resolve)</span><br><span class=\"line\">      <span class=\"comment\">// 根据 index 生成唯一的组件名称</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> name = <span class=\"string\">`iframe-<span class=\"subst\">$&#123;index&#125;</span>`</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">hasOpen</span>: <span class=\"literal\">false</span>, <span class=\"comment\">// 是否打开过，默认false</span></span><br><span class=\"line\">        ...item,</span><br><span class=\"line\">        name, <span class=\"comment\">// 组件名称</span></span><br><span class=\"line\">        <span class=\"attr\">component</span>: componentPath <span class=\"comment\">// 组件文件的引用</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// 交给vuex管理</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;setIframeComponentList&#x27;</span>, iframeComponentList)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">handleIframe</span>(<span class=\"params\">menu, newMenu</span>) &#123;</span><br><span class=\"line\">    menu.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 根据规则判断是否为 Iframe 类型的路由</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (item.<span class=\"property\">meta</span> &amp;&amp; item.<span class=\"property\">meta</span>.<span class=\"property\">componentName</span> &amp;&amp; item.<span class=\"property\">meta</span>.<span class=\"property\">componentName</span>.<span class=\"title function_\">includes</span>(<span class=\"string\">&#x27;Iframe&#x27;</span>)) &#123;</span><br><span class=\"line\">        newMenu.<span class=\"title function_\">push</span>(item)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (item.<span class=\"property\">children</span> &amp;&amp; item.<span class=\"property\">children</span>.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">handleIframe</span>(item.<span class=\"property\">children</span>, newMenu)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> newMenu</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"设置-Iframe-路由在打开后为打开状态，用于缓存\"><a href=\"#设置-Iframe-路由在打开后为打开状态，用于缓存\" class=\"headerlink\" title=\"设置 Iframe 路由在打开后为打开状态，用于缓存\"></a>设置 Iframe 路由在打开后为打开状态，用于缓存</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">computed</span>: &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 实现懒加载，只渲染已经打开过（hasOpen:true）的 iframe 页</span></span><br><span class=\"line\">  <span class=\"title function_\">hasOpenComponentList</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">filter</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> item.<span class=\"property\">hasOpen</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"attr\">methods</span>: &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 根据当前路由设置 hasOpen</span></span><br><span class=\"line\">  <span class=\"title function_\">isOpenIframePage</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> target = <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">find</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">$route</span>.<span class=\"property\">path</span>.<span class=\"title function_\">includes</span>(item.<span class=\"property\">path</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (target &amp;&amp; !target.<span class=\"property\">hasOpen</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> index = <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">indexOf</span>(target)</span><br><span class=\"line\">      <span class=\"keyword\">let</span> hasOpen = <span class=\"literal\">true</span></span><br><span class=\"line\">\t  <span class=\"comment\">// 更改 vuex 中 iframe 路由列表中的打开状态</span></span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;setIframeComponentHasOpen&#x27;</span>, &#123; index, hasOpen &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用-Iframe-路由组件\"><a href=\"#使用-Iframe-路由组件\" class=\"headerlink\" title=\"使用 Iframe 路由组件\"></a>使用 Iframe 路由组件</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">component</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in hasOpenComponentList&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:key</span>=<span class=\"string\">&quot;item.name&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:is</span>=<span class=\"string\">&quot;item.name&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:linkUrl</span>=<span class=\"string\">&quot;item.meta.url&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">v-show</span>=<span class=\"string\">&quot;$route.path.includes(item.path)&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">component</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Iframe-路由出口组件完整代码\"><a href=\"#Iframe-路由出口组件完整代码\" class=\"headerlink\" title=\"Iframe 路由出口组件完整代码\"></a>Iframe 路由出口组件完整代码</h3><p>在项目中的菜单页面的路由出口处，将 <code>route-view</code> 组件更换成以下封装的 <code>iframe-route-view</code> 即可使用</p>\n<p><strong>注意：这里的 <code>route-view</code> 是 <code>JEECG</code> 框架在 <code>vue-router</code> 官方提供的 <code>router-view</code> 上封装了一层的自定义组件</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&#x27;main&#x27;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 非 iframe 页 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">route-view</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&#x27;!$route.meta.componentName.includes(&quot;Iframe&quot;)&#x27;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">route-view</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- iframe 页 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&#x27;hasOpenComponentList.length&#x27;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">component</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">v-for</span>=<span class=\"string\">&#x27;item in hasOpenComponentList&#x27;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">:key</span>=<span class=\"string\">&#x27;item.name&#x27;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">:is</span>=<span class=\"string\">&#x27;item.name&#x27;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">:linkUrl</span>=<span class=\"string\">&#x27;item.meta.url&#x27;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">v-show</span>=<span class=\"string\">&#x27;$route.path.includes(item.path)&#x27;</span></span></span><br><span class=\"line\"><span class=\"tag\">      &gt;</span><span class=\"tag\">&lt;/<span class=\"name\">component</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">Vue</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; mapState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuex&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">RouteView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/components/layouts/RouteView&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">name</span>: <span class=\"string\">&#x27;IframeRouteView&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">components</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title class_\">RouteView</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">created</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"property\">length</span> === <span class=\"number\">0</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">getIframeComponentList</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 注册 iframe 页组件</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"title class_\">Vue</span>.<span class=\"title function_\">component</span>(item.<span class=\"property\">name</span>, item.<span class=\"property\">component</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 初始化判断当前路由是否 iframe 页</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">isOpenIframePage</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">watch</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    $route() &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"property\">length</span> === <span class=\"number\">0</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">getIframeComponentList</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"comment\">// 判断当前路由是否iframe页</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">isOpenIframePage</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">computed</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    ...<span class=\"title function_\">mapState</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"comment\">// 动态主路由</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"attr\">mainMenu</span>: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> state.<span class=\"property\">user</span>.<span class=\"property\">allPermissionList</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"attr\">iframeComponentList</span>: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> state.<span class=\"property\">app</span>.<span class=\"property\">iframeComponentList</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;),</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 实现懒加载，只渲染已经打开过（hasOpen:true）的 iframe 页</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">hasOpenComponentList</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">filter</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> item.<span class=\"property\">hasOpen</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">methods</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 根据当前路由设置hasOpen</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">isOpenIframePage</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> target = <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">find</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">$route</span>.<span class=\"property\">path</span>.<span class=\"title function_\">includes</span>(item.<span class=\"property\">path</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">if</span> (target &amp;&amp; !target.<span class=\"property\">hasOpen</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">let</span> index = <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">indexOf</span>(target)</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">let</span> hasOpen = <span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">// 更改 vuex 中 iframe 路由列表中的打开状态</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;setIframeComponentHasOpen&#x27;</span>, &#123; index, hasOpen &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">getIframeComponentList</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> iframeMenuList = <span class=\"variable language_\">this</span>.<span class=\"title function_\">handleIframe</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">mainMenu</span>, [])</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> iframeComponentList = iframeMenuList.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">item, index</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">// 设置组件</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">let</span> component = <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">if</span>(item.<span class=\"property\">component</span>.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&quot;layouts&quot;</span>)&gt;=<span class=\"number\">0</span>)&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          component = <span class=\"string\">&quot;components/&quot;</span>+item.<span class=\"property\">component</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;<span class=\"keyword\">else</span>&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          component = <span class=\"string\">&quot;views/&quot;</span>+item.<span class=\"property\">component</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">const</span> <span class=\"title function_\">componentPath</span> = resolve =&gt; <span class=\"built_in\">require</span>([<span class=\"string\">&#x27;@/&#x27;</span> + component+<span class=\"string\">&#x27;.vue&#x27;</span>], resolve)</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">// 根据 index 生成唯一的组件名称</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">const</span> name = <span class=\"string\">`iframe-<span class=\"subst\">$&#123;index&#125;</span>`</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"attr\">hasOpen</span>: <span class=\"literal\">false</span>, <span class=\"comment\">// 是否打开过，默认false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">          ...item,</span></span><br><span class=\"line\"><span class=\"language-javascript\">          name, <span class=\"comment\">// 组件名称</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"attr\">component</span>: componentPath <span class=\"comment\">// 组件文件的引用</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"comment\">// 交给 vuex 管理</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;setIframeComponentList&#x27;</span>, iframeComponentList)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">handleIframe</span>(<span class=\"params\">menu, newMenu</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      menu.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">// push所有的iframe节点</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">if</span> (item.<span class=\"property\">meta</span> &amp;&amp; item.<span class=\"property\">meta</span>.<span class=\"property\">componentName</span> &amp;&amp; item.<span class=\"property\">meta</span>.<span class=\"property\">componentName</span>.<span class=\"title function_\">includes</span>(<span class=\"string\">&#x27;Iframe&#x27;</span>)) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          newMenu.<span class=\"title function_\">push</span>(item)</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">if</span> (item.<span class=\"property\">children</span> &amp;&amp; item.<span class=\"property\">children</span>.<span class=\"property\">length</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"variable language_\">this</span>.<span class=\"title function_\">handleIframe</span>(item.<span class=\"property\">children</span>, newMenu)</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> newMenu</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">lang</span>=<span class=\"string\">&#x27;less&#x27;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"扩展一：使用-Vuex-管理-Iframe-组件列表\"><a href=\"#扩展一：使用-Vuex-管理-Iframe-组件列表\" class=\"headerlink\" title=\"扩展一：使用 Vuex 管理 Iframe 组件列表\"></a>扩展一：使用 Vuex 管理 Iframe 组件列表</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Vue</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">IFRAME_COMPONENT_LIST</span> = <span class=\"string\">&quot;IFRAME_COMPONENT_LIST&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> iframe = &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">iframeComponentList</span>: [], <span class=\"comment\">//iframe组件列表</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">mutations</span>: &#123;</span><br><span class=\"line\">    <span class=\"variable constant_\">SET_IFRAME_COMPONENT_LIST</span> (state, iframeComponentList) &#123;</span><br><span class=\"line\">      <span class=\"title class_\">Vue</span>.<span class=\"property\">ls</span>.<span class=\"title function_\">set</span>(<span class=\"variable constant_\">IFRAME_COMPONENT_LIST</span>, iframeComponentList)</span><br><span class=\"line\">      state.<span class=\"property\">iframeComponentList</span> = iframeComponentList</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"variable constant_\">SET_IFRAME_COMPONENT_HAS_OPENED</span> (state, &#123;index, hasOpen&#125;) &#123;</span><br><span class=\"line\">      state.<span class=\"property\">iframeComponentList</span>[index].<span class=\"property\">hasOpen</span> = hasOpen</span><br><span class=\"line\">      <span class=\"title class_\">Vue</span>.<span class=\"property\">ls</span>.<span class=\"title function_\">set</span>(<span class=\"variable constant_\">IFRAME_COMPONENT_LIST</span>, state.<span class=\"property\">iframeComponentList</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setIframeComponentList</span>(<span class=\"params\">&#123; commit &#125;, iframeComponentList</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">commit</span>(<span class=\"string\">&#x27;SET_IFRAME_COMPONENT_LIST&#x27;</span>, iframeComponentList)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"title function_\">setIframeComponentHasOpen</span>(<span class=\"params\">&#123; commit &#125;, &#123;index, hasOpen&#125;</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">commit</span>(<span class=\"string\">&#x27;SET_IFRAME_COMPONENT_HAS_OPENED&#x27;</span>, &#123;index, hasOpen&#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> iframe</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"扩展二：在关闭-Tab-标签页时改变页面的打开状态\"><a href=\"#扩展二：在关闭-Tab-标签页时改变页面的打开状态\" class=\"headerlink\" title=\"扩展二：在关闭 Tab 标签页时改变页面的打开状态\"></a>扩展二：在关闭 Tab 标签页时改变页面的打开状态</h3><p><strong>注意：以下修改方式仅适用于当前项目，经供参考</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">close</span>(<span class=\"params\">pageKey</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> index = <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">findIndex</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> pageKey.<span class=\"title function_\">includes</span>(item.<span class=\"property\">path</span>))</span><br><span class=\"line\">    <span class=\"keyword\">let</span> hasOpen = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;setIframeComponentHasOpen&#x27;</span>, &#123; index, hasOpen &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>整体的实现思路并不复杂，但是运用到实际项目中还是会牵动到项目框架本身的结构，可能会引起其他的问题，个人工作记录，仅供参考，如有不足之处，欢迎友友们在文章末尾进行留言交流指正。</p>\n","more":"<h2 id=\"项目背景\"><a href=\"#项目背景\" class=\"headerlink\" title=\"项目背景\"></a>项目背景</h2><p>在我们日常项目开发中，可能会涉及到其他项目嵌入到本项目中。本人在工作中正好碰到了一个需求，需要将旧系统中大量的 <code>HTML</code> 页面嵌入到 <code>Vue</code> 的项目中，嵌入方式是采用 <code>Iframe</code>，但是若使用 Iframe 嵌入页面，那么页面缓存就相当重要，否则用户每次切换到 Iframe 页面类型的菜单，都要重新加载页面，这样非常浪费时间，并且很影响用户的体验。经过网上查阅资料以及结合项目情况，这里记录一下本次问题的解决思路及实现方案。</p>\n<blockquote>\n<p>项目框架：<a href=\"https://github.com/jeecgboot/ant-design-vue-jeecg\">jeecgboot/ant-design-vue-jeecg: 基于 Vue2 + AntDesignVue 实现的 Ant Design Pro（github.com）</a></p>\n<p>参考：<a href=\"https://juejin.cn/post/7160873633408090119\">vue 应用缓存 iframe 页面 - 掘金 (juejin.cn)</a></p>\n</blockquote>\n<h2 id=\"解决思路\"><a href=\"#解决思路\" class=\"headerlink\" title=\"解决思路\"></a>解决思路</h2><ol>\n<li>通过自定义规则区分 Iframe 类型路由与非 Iframe 类型路由</li>\n<li>手动获取 Iframe 类型路由的路由信息，并且手动注册所有的 Iframe 路由组件</li>\n<li>Iframe 页面打开时或页面切换时，设置对应的 Iframe 组件为打开状态</li>\n<li>获取所有已打开的 Iframe 路由组件，<code>v-for</code> 循环展示 Iframe 路由组件，并根据当前路由信息结合组件信息判断，使用 <code>v-show</code> 控制组件的显隐</li>\n</ol>\n<blockquote>\n<p><strong>关键：将所有 Iframe 类型页面全部注册为 Vue 组件，并且通过打开状态进行展示（懒加载），通过路由信息来控制组件的显隐状态（缓存）</strong></p>\n</blockquote>\n<h2 id=\"实现方案\"><a href=\"#实现方案\" class=\"headerlink\" title=\"实现方案\"></a>实现方案</h2><h3 id=\"区分-Iframe-路由\"><a href=\"#区分-Iframe-路由\" class=\"headerlink\" title=\"区分 Iframe 路由\"></a>区分 Iframe 路由</h3><p>本项目中是使用路由信息中 <code>meta</code> 数据中的 <code>componentName</code> 来判断的，只要 componentName 包含 Iframe 就代表是 <code>Iframe</code> 类型的路由（区分规则以实际项目为准）</p>\n<h3 id=\"获取所有的-Iframe-路由组件\"><a href=\"#获取所有的-Iframe-路由组件\" class=\"headerlink\" title=\"获取所有的 Iframe 路由组件\"></a>获取所有的 Iframe 路由组件</h3><p>本项目中采用了动态路由，数据存放在 <code>Vuex</code> 中，用户登录时从数据库加载当前用户的路由菜单。并且项目脚手架是使用 <code>Ant Design Pro</code>，采用的是 Tab 多页签模式，所以在关闭 Tab 时也需要修改 Iframe 组件的状态，所以将 Iframe 组件列表也存放在 Vuex 中，方便在不同组件中共享数据</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">computed</span>: &#123;</span><br><span class=\"line\">  ...<span class=\"title function_\">mapState</span>(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 动态路由</span></span><br><span class=\"line\">    <span class=\"attr\">mainMenu</span>: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> state.<span class=\"property\">user</span>.<span class=\"property\">allPermissionList</span>,</span><br><span class=\"line\">    <span class=\"attr\">iframeComponentList</span>: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> state.<span class=\"property\">app</span>.<span class=\"property\">iframeComponentList</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"attr\">methods</span>: &#123;</span><br><span class=\"line\">  <span class=\"title function_\">getIframeComponentList</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> iframeMenuList = <span class=\"variable language_\">this</span>.<span class=\"title function_\">handleIframe</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">mainMenu</span>, [])</span><br><span class=\"line\">    <span class=\"keyword\">const</span> iframeComponentList = iframeMenuList.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">item, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 设置组件</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> component = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(item.<span class=\"property\">component</span>.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&quot;layouts&quot;</span>)&gt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        component = <span class=\"string\">&quot;components/&quot;</span>+item.<span class=\"property\">component</span>;</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        component = <span class=\"string\">&quot;views/&quot;</span>+item.<span class=\"property\">component</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> <span class=\"title function_\">componentPath</span> = resolve =&gt; <span class=\"built_in\">require</span>([<span class=\"string\">&#x27;@/&#x27;</span> + component+<span class=\"string\">&#x27;.vue&#x27;</span>], resolve)</span><br><span class=\"line\">      <span class=\"comment\">// 根据 index 生成唯一的组件名称</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> name = <span class=\"string\">`iframe-<span class=\"subst\">$&#123;index&#125;</span>`</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">hasOpen</span>: <span class=\"literal\">false</span>, <span class=\"comment\">// 是否打开过，默认false</span></span><br><span class=\"line\">        ...item,</span><br><span class=\"line\">        name, <span class=\"comment\">// 组件名称</span></span><br><span class=\"line\">        <span class=\"attr\">component</span>: componentPath <span class=\"comment\">// 组件文件的引用</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// 交给vuex管理</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;setIframeComponentList&#x27;</span>, iframeComponentList)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">handleIframe</span>(<span class=\"params\">menu, newMenu</span>) &#123;</span><br><span class=\"line\">    menu.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 根据规则判断是否为 Iframe 类型的路由</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (item.<span class=\"property\">meta</span> &amp;&amp; item.<span class=\"property\">meta</span>.<span class=\"property\">componentName</span> &amp;&amp; item.<span class=\"property\">meta</span>.<span class=\"property\">componentName</span>.<span class=\"title function_\">includes</span>(<span class=\"string\">&#x27;Iframe&#x27;</span>)) &#123;</span><br><span class=\"line\">        newMenu.<span class=\"title function_\">push</span>(item)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (item.<span class=\"property\">children</span> &amp;&amp; item.<span class=\"property\">children</span>.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">handleIframe</span>(item.<span class=\"property\">children</span>, newMenu)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> newMenu</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"设置-Iframe-路由在打开后为打开状态，用于缓存\"><a href=\"#设置-Iframe-路由在打开后为打开状态，用于缓存\" class=\"headerlink\" title=\"设置 Iframe 路由在打开后为打开状态，用于缓存\"></a>设置 Iframe 路由在打开后为打开状态，用于缓存</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">computed</span>: &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 实现懒加载，只渲染已经打开过（hasOpen:true）的 iframe 页</span></span><br><span class=\"line\">  <span class=\"title function_\">hasOpenComponentList</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">filter</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> item.<span class=\"property\">hasOpen</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"attr\">methods</span>: &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 根据当前路由设置 hasOpen</span></span><br><span class=\"line\">  <span class=\"title function_\">isOpenIframePage</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> target = <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">find</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">$route</span>.<span class=\"property\">path</span>.<span class=\"title function_\">includes</span>(item.<span class=\"property\">path</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (target &amp;&amp; !target.<span class=\"property\">hasOpen</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> index = <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">indexOf</span>(target)</span><br><span class=\"line\">      <span class=\"keyword\">let</span> hasOpen = <span class=\"literal\">true</span></span><br><span class=\"line\">\t  <span class=\"comment\">// 更改 vuex 中 iframe 路由列表中的打开状态</span></span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;setIframeComponentHasOpen&#x27;</span>, &#123; index, hasOpen &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用-Iframe-路由组件\"><a href=\"#使用-Iframe-路由组件\" class=\"headerlink\" title=\"使用 Iframe 路由组件\"></a>使用 Iframe 路由组件</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">component</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;item in hasOpenComponentList&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:key</span>=<span class=\"string\">&quot;item.name&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:is</span>=<span class=\"string\">&quot;item.name&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:linkUrl</span>=<span class=\"string\">&quot;item.meta.url&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">v-show</span>=<span class=\"string\">&quot;$route.path.includes(item.path)&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">component</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Iframe-路由出口组件完整代码\"><a href=\"#Iframe-路由出口组件完整代码\" class=\"headerlink\" title=\"Iframe 路由出口组件完整代码\"></a>Iframe 路由出口组件完整代码</h3><p>在项目中的菜单页面的路由出口处，将 <code>route-view</code> 组件更换成以下封装的 <code>iframe-route-view</code> 即可使用</p>\n<p><strong>注意：这里的 <code>route-view</code> 是 <code>JEECG</code> 框架在 <code>vue-router</code> 官方提供的 <code>router-view</code> 上封装了一层的自定义组件</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&#x27;main&#x27;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 非 iframe 页 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">route-view</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&#x27;!$route.meta.componentName.includes(&quot;Iframe&quot;)&#x27;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">route-view</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- iframe 页 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">v-if</span>=<span class=\"string\">&#x27;hasOpenComponentList.length&#x27;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">component</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">v-for</span>=<span class=\"string\">&#x27;item in hasOpenComponentList&#x27;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">:key</span>=<span class=\"string\">&#x27;item.name&#x27;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">:is</span>=<span class=\"string\">&#x27;item.name&#x27;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">:linkUrl</span>=<span class=\"string\">&#x27;item.meta.url&#x27;</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">v-show</span>=<span class=\"string\">&#x27;$route.path.includes(item.path)&#x27;</span></span></span><br><span class=\"line\"><span class=\"tag\">      &gt;</span><span class=\"tag\">&lt;/<span class=\"name\">component</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">Vue</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> &#123; mapState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuex&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">import</span> <span class=\"title class_\">RouteView</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/components/layouts/RouteView&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">name</span>: <span class=\"string\">&#x27;IframeRouteView&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">components</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title class_\">RouteView</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"title function_\">created</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"property\">length</span> === <span class=\"number\">0</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">getIframeComponentList</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 注册 iframe 页组件</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"title class_\">Vue</span>.<span class=\"title function_\">component</span>(item.<span class=\"property\">name</span>, item.<span class=\"property\">component</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 初始化判断当前路由是否 iframe 页</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">isOpenIframePage</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">watch</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    $route() &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"property\">length</span> === <span class=\"number\">0</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">getIframeComponentList</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"comment\">// 判断当前路由是否iframe页</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">isOpenIframePage</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">computed</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    ...<span class=\"title function_\">mapState</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"comment\">// 动态主路由</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"attr\">mainMenu</span>: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> state.<span class=\"property\">user</span>.<span class=\"property\">allPermissionList</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"attr\">iframeComponentList</span>: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> state.<span class=\"property\">app</span>.<span class=\"property\">iframeComponentList</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;),</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 实现懒加载，只渲染已经打开过（hasOpen:true）的 iframe 页</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">hasOpenComponentList</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">filter</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> item.<span class=\"property\">hasOpen</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">  <span class=\"attr\">methods</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"comment\">// 根据当前路由设置hasOpen</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">isOpenIframePage</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> target = <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">find</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">$route</span>.<span class=\"property\">path</span>.<span class=\"title function_\">includes</span>(item.<span class=\"property\">path</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">if</span> (target &amp;&amp; !target.<span class=\"property\">hasOpen</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">let</span> index = <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">indexOf</span>(target)</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">let</span> hasOpen = <span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">// 更改 vuex 中 iframe 路由列表中的打开状态</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;setIframeComponentHasOpen&#x27;</span>, &#123; index, hasOpen &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">getIframeComponentList</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> iframeMenuList = <span class=\"variable language_\">this</span>.<span class=\"title function_\">handleIframe</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">mainMenu</span>, [])</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">const</span> iframeComponentList = iframeMenuList.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">item, index</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">// 设置组件</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">let</span> component = <span class=\"string\">&quot;&quot;</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">if</span>(item.<span class=\"property\">component</span>.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&quot;layouts&quot;</span>)&gt;=<span class=\"number\">0</span>)&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          component = <span class=\"string\">&quot;components/&quot;</span>+item.<span class=\"property\">component</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;<span class=\"keyword\">else</span>&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          component = <span class=\"string\">&quot;views/&quot;</span>+item.<span class=\"property\">component</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">const</span> <span class=\"title function_\">componentPath</span> = resolve =&gt; <span class=\"built_in\">require</span>([<span class=\"string\">&#x27;@/&#x27;</span> + component+<span class=\"string\">&#x27;.vue&#x27;</span>], resolve)</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">// 根据 index 生成唯一的组件名称</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">const</span> name = <span class=\"string\">`iframe-<span class=\"subst\">$&#123;index&#125;</span>`</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"attr\">hasOpen</span>: <span class=\"literal\">false</span>, <span class=\"comment\">// 是否打开过，默认false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">          ...item,</span></span><br><span class=\"line\"><span class=\"language-javascript\">          name, <span class=\"comment\">// 组件名称</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"attr\">component</span>: componentPath <span class=\"comment\">// 组件文件的引用</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"comment\">// 交给 vuex 管理</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;setIframeComponentList&#x27;</span>, iframeComponentList)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">    <span class=\"title function_\">handleIframe</span>(<span class=\"params\">menu, newMenu</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      menu.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"comment\">// push所有的iframe节点</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">if</span> (item.<span class=\"property\">meta</span> &amp;&amp; item.<span class=\"property\">meta</span>.<span class=\"property\">componentName</span> &amp;&amp; item.<span class=\"property\">meta</span>.<span class=\"property\">componentName</span>.<span class=\"title function_\">includes</span>(<span class=\"string\">&#x27;Iframe&#x27;</span>)) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          newMenu.<span class=\"title function_\">push</span>(item)</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">if</span> (item.<span class=\"property\">children</span> &amp;&amp; item.<span class=\"property\">children</span>.<span class=\"property\">length</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">          <span class=\"variable language_\">this</span>.<span class=\"title function_\">handleIframe</span>(item.<span class=\"property\">children</span>, newMenu)</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">      &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">      <span class=\"keyword\">return</span> newMenu</span></span><br><span class=\"line\"><span class=\"language-javascript\">    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">  &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">lang</span>=<span class=\"string\">&#x27;less&#x27;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"扩展一：使用-Vuex-管理-Iframe-组件列表\"><a href=\"#扩展一：使用-Vuex-管理-Iframe-组件列表\" class=\"headerlink\" title=\"扩展一：使用 Vuex 管理 Iframe 组件列表\"></a>扩展一：使用 Vuex 管理 Iframe 组件列表</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Vue</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">IFRAME_COMPONENT_LIST</span> = <span class=\"string\">&quot;IFRAME_COMPONENT_LIST&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> iframe = &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">iframeComponentList</span>: [], <span class=\"comment\">//iframe组件列表</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">mutations</span>: &#123;</span><br><span class=\"line\">    <span class=\"variable constant_\">SET_IFRAME_COMPONENT_LIST</span> (state, iframeComponentList) &#123;</span><br><span class=\"line\">      <span class=\"title class_\">Vue</span>.<span class=\"property\">ls</span>.<span class=\"title function_\">set</span>(<span class=\"variable constant_\">IFRAME_COMPONENT_LIST</span>, iframeComponentList)</span><br><span class=\"line\">      state.<span class=\"property\">iframeComponentList</span> = iframeComponentList</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"variable constant_\">SET_IFRAME_COMPONENT_HAS_OPENED</span> (state, &#123;index, hasOpen&#125;) &#123;</span><br><span class=\"line\">      state.<span class=\"property\">iframeComponentList</span>[index].<span class=\"property\">hasOpen</span> = hasOpen</span><br><span class=\"line\">      <span class=\"title class_\">Vue</span>.<span class=\"property\">ls</span>.<span class=\"title function_\">set</span>(<span class=\"variable constant_\">IFRAME_COMPONENT_LIST</span>, state.<span class=\"property\">iframeComponentList</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setIframeComponentList</span>(<span class=\"params\">&#123; commit &#125;, iframeComponentList</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">commit</span>(<span class=\"string\">&#x27;SET_IFRAME_COMPONENT_LIST&#x27;</span>, iframeComponentList)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"title function_\">setIframeComponentHasOpen</span>(<span class=\"params\">&#123; commit &#125;, &#123;index, hasOpen&#125;</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">commit</span>(<span class=\"string\">&#x27;SET_IFRAME_COMPONENT_HAS_OPENED&#x27;</span>, &#123;index, hasOpen&#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> iframe</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"扩展二：在关闭-Tab-标签页时改变页面的打开状态\"><a href=\"#扩展二：在关闭-Tab-标签页时改变页面的打开状态\" class=\"headerlink\" title=\"扩展二：在关闭 Tab 标签页时改变页面的打开状态\"></a>扩展二：在关闭 Tab 标签页时改变页面的打开状态</h3><p><strong>注意：以下修改方式仅适用于当前项目，经供参考</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">close</span>(<span class=\"params\">pageKey</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> index = <span class=\"variable language_\">this</span>.<span class=\"property\">iframeComponentList</span>.<span class=\"title function_\">findIndex</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> pageKey.<span class=\"title function_\">includes</span>(item.<span class=\"property\">path</span>))</span><br><span class=\"line\">    <span class=\"keyword\">let</span> hasOpen = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;setIframeComponentHasOpen&#x27;</span>, &#123; index, hasOpen &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>整体的实现思路并不复杂，但是运用到实际项目中还是会牵动到项目框架本身的结构，可能会引起其他的问题，个人工作记录，仅供参考，如有不足之处，欢迎友友们在文章末尾进行留言交流指正。</p>\n","categories":[{"name":"前端开发","path":"api/categories/前端开发.json"}],"tags":[{"name":"技巧","path":"api/tags/技巧.json"},{"name":"笔记","path":"api/tags/笔记.json"},{"name":"Vue","path":"api/tags/Vue.json"}]}