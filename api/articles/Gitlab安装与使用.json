{"title":"GitLab 的安装与使用","slug":"Gitlab安装与使用","date":"2022-01-11T07:26:59.000Z","updated":"2022-01-11T07:26:59.000Z","comments":true,"path":"api/articles/Gitlab安装与使用.json","excerpt":null,"covers":["https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220111153600.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220111154833.png","https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220111155220.png"],"content":"<h2 id=\"Docker-安装-GitLab\"><a href=\"#Docker-安装-GitLab\" class=\"headerlink\" title=\"Docker 安装 GitLab\"></a>Docker 安装 GitLab</h2><p>DockerHub 上有许多制作完善的镜像，直接搜索 <code>gitlab</code> 查看镜像：</p>\n<p><strong>搜索镜像</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search gitlab</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220111153600.png\" alt=\"image-20220111153600801\"></p>\n<blockquote>\n<p>这里可以选择汉化的 GitLab 社区版的镜像进行下载</p>\n</blockquote>\n<p><strong>下载镜像</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull twang2218/gitlab-ce-zh</span><br></pre></td></tr></table></figure>\n\n<p><strong>启动镜像</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -p 8443:443 -p 8090:80 -p 8022:22 --restart always --name gitlab -v /usr/local/gitlab/etc:/etc/gitlab -v /usr/local/gitlab/log:/var/log/gitlab -v /usr/local/gitlab/data:/var/opt/gitlab --privileged=true twang2218/gitlab-ce-zh</span><br><span class=\"line\"></span><br><span class=\"line\">命令解释：</span><br><span class=\"line\">-d 后台启动</span><br><span class=\"line\">-p 映射端口</span><br><span class=\"line\">--restart 重启配置</span><br><span class=\"line\">-v 卷挂载</span><br><span class=\"line\">--privileged=true 设置root权限</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置-GitLab\"><a href=\"#配置-GitLab\" class=\"headerlink\" title=\"配置 GitLab\"></a>配置 GitLab</h2><p><strong>编辑 <code>gitlab.rb</code> 文件</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">直接修改 -v 挂载后的目录，docker会自动同步到容器内部</span></span><br><span class=\"line\">vim /usr/local/gitlab/etc/gitlab.rb</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改ip和端口 可以使用 / 来定位配置项</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">http地址 -- 无需配置端口</span></span><br><span class=\"line\">external_url &#x27;http://xx.xx.xx.xx&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ssh地址 -- 无需配置端口</span></span><br><span class=\"line\">gitlab_rails[&#x27;gitlab_ssh_host&#x27;] = &#x27;xx.xx.xx.xx&#x27;(不用添加端口)</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ssh端口 默认22 启动容器时我们映射为8022</span></span><br><span class=\"line\">gitlab_rails[&#x27;gitlab_shell_ssh_port&#x27;] = 8022</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">========== 邮箱配置 ==============</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">是否启用</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_enable&#x27;] = true</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">SMTP服务的地址</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_address&#x27;] = &quot;smtp.qq.com&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">端口</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_port&#x27;] = 465</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">你的QQ邮箱（发送账号）</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_user_name&#x27;] = &quot;958317640@qq.com&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">授权码</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_password&#x27;] = &quot;********&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">域名</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_domain&#x27;] = &quot;smtp.qq.com&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">登录验证</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_authentication&#x27;] = &quot;login&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用了465端口，就需要配置下面三项</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_enable_starttls_auto&#x27;] = true</span><br><span class=\"line\">gitlab_rails[&#x27;smtp_tls&#x27;] = true</span><br><span class=\"line\">gitlab_rails[&#x27;smtp_openssl_verify_mode&#x27;] = &#x27;none&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">你的QQ邮箱（发送账号）</span></span><br><span class=\"line\">gitlab_rails[&#x27;gitlab_email_from&#x27;] = &#x27;958317640@qq.com&#x27;</span><br></pre></td></tr></table></figure>\n\n<p><strong>应用配置</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">注意观察日志输出</span></span><br><span class=\"line\">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220111154833.png\" alt=\"image-20220111154833139\"></p>\n<p><strong>编辑 <code>gitlab.yml</code></strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入容器</span></span><br><span class=\"line\">docker exec -it gitlab bash</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">编辑yml配置</span></span><br><span class=\"line\">vim /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改port为启动时映射的端口</span></span><br><span class=\"line\">port: 8090</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">重启服务并测试</span></span><br><span class=\"line\">gitlab-ctl restart</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220111155220.png\" alt=\"image-20220111155220504\"></p>\n","more":"<h2 id=\"Docker-安装-GitLab\"><a href=\"#Docker-安装-GitLab\" class=\"headerlink\" title=\"Docker 安装 GitLab\"></a>Docker 安装 GitLab</h2><p>DockerHub 上有许多制作完善的镜像，直接搜索 <code>gitlab</code> 查看镜像：</p>\n<p><strong>搜索镜像</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search gitlab</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220111153600.png\" alt=\"image-20220111153600801\"></p>\n<blockquote>\n<p>这里可以选择汉化的 GitLab 社区版的镜像进行下载</p>\n</blockquote>\n<p><strong>下载镜像</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull twang2218/gitlab-ce-zh</span><br></pre></td></tr></table></figure>\n\n<p><strong>启动镜像</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -p 8443:443 -p 8090:80 -p 8022:22 --restart always --name gitlab -v /usr/local/gitlab/etc:/etc/gitlab -v /usr/local/gitlab/log:/var/log/gitlab -v /usr/local/gitlab/data:/var/opt/gitlab --privileged=true twang2218/gitlab-ce-zh</span><br><span class=\"line\"></span><br><span class=\"line\">命令解释：</span><br><span class=\"line\">-d 后台启动</span><br><span class=\"line\">-p 映射端口</span><br><span class=\"line\">--restart 重启配置</span><br><span class=\"line\">-v 卷挂载</span><br><span class=\"line\">--privileged=true 设置root权限</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置-GitLab\"><a href=\"#配置-GitLab\" class=\"headerlink\" title=\"配置 GitLab\"></a>配置 GitLab</h2><p><strong>编辑 <code>gitlab.rb</code> 文件</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">直接修改 -v 挂载后的目录，docker会自动同步到容器内部</span></span><br><span class=\"line\">vim /usr/local/gitlab/etc/gitlab.rb</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改ip和端口 可以使用 / 来定位配置项</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">http地址 -- 无需配置端口</span></span><br><span class=\"line\">external_url &#x27;http://xx.xx.xx.xx&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ssh地址 -- 无需配置端口</span></span><br><span class=\"line\">gitlab_rails[&#x27;gitlab_ssh_host&#x27;] = &#x27;xx.xx.xx.xx&#x27;(不用添加端口)</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ssh端口 默认22 启动容器时我们映射为8022</span></span><br><span class=\"line\">gitlab_rails[&#x27;gitlab_shell_ssh_port&#x27;] = 8022</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">========== 邮箱配置 ==============</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">是否启用</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_enable&#x27;] = true</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">SMTP服务的地址</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_address&#x27;] = &quot;smtp.qq.com&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">端口</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_port&#x27;] = 465</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">你的QQ邮箱（发送账号）</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_user_name&#x27;] = &quot;958317640@qq.com&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">授权码</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_password&#x27;] = &quot;********&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">域名</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_domain&#x27;] = &quot;smtp.qq.com&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">登录验证</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_authentication&#x27;] = &quot;login&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用了465端口，就需要配置下面三项</span></span><br><span class=\"line\">gitlab_rails[&#x27;smtp_enable_starttls_auto&#x27;] = true</span><br><span class=\"line\">gitlab_rails[&#x27;smtp_tls&#x27;] = true</span><br><span class=\"line\">gitlab_rails[&#x27;smtp_openssl_verify_mode&#x27;] = &#x27;none&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">你的QQ邮箱（发送账号）</span></span><br><span class=\"line\">gitlab_rails[&#x27;gitlab_email_from&#x27;] = &#x27;958317640@qq.com&#x27;</span><br></pre></td></tr></table></figure>\n\n<p><strong>应用配置</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">注意观察日志输出</span></span><br><span class=\"line\">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220111154833.png\" alt=\"image-20220111154833139\"></p>\n<p><strong>编辑 <code>gitlab.yml</code></strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入容器</span></span><br><span class=\"line\">docker exec -it gitlab bash</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">编辑yml配置</span></span><br><span class=\"line\">vim /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改port为启动时映射的端口</span></span><br><span class=\"line\">port: 8090</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">重启服务并测试</span></span><br><span class=\"line\">gitlab-ctl restart</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://my-typora-oss.oss-cn-shanghai.aliyuncs.com/image-master/20220111155220.png\" alt=\"image-20220111155220504\"></p>\n","categories":[{"name":"Linux","path":"api/categories/Linux.json"}],"tags":[{"name":"Docker","path":"api/tags/Docker.json"},{"name":"容器","path":"api/tags/容器.json"},{"name":"Git","path":"api/tags/Git.json"}]}